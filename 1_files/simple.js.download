var fontsize = 17;
var fontfamily = 'Arial, sans-serif';

var x_p = 38;			//M������λ�����꣬��ʼ���꣬����������Ǹ�������������
var y_p = 10;			//M������λ�����꣬��ʼ���꣬����������Ǹ�������������
var gridwidth = 100;		//y�������߿��

var lengend_x_p = 60;
var lengend_y_p = y_p - 15 - gridwidth * 2 - 25;

function drawAxis(var1){
	var codes = var1;
	// var sites = var2;
	//parameters build-in
	var x_origin = 60;
	var y_origin = 280;
	// var gps =new Array();
	// for(var i = 0; i < sites.length; i++) {
	// 	var arr = sites[i].split("-");
	// 	var residue = arr[0];
	// 	gps[i] = parseInt(arr[1]) - 1;
	// 	//alert(gps[i]);
	// }

	//origin coordinate
	var center_x = x_origin - fontsize / 2;
	var center_y = y_origin - fontsize / 2 - 5;

	var xAxis_x_start = center_x;
	var xAxis_y_start = center_y;	

	//origin start
	var yAxis_x_start = center_x;
	var yAxis_y_start = center_y;

	//draw xAxis
	for(var i = 0; i < codes.length; i++) {


		var xAxis_x_end = xAxis_x_start + 1.5*fontsize;
		var xAxis_y_end = xAxis_y_start;		
		$('canvas.axis').drawLine({
		  layer: true,
		  strokeStyle: 'grey',
		  strokeWidth: 1.5,
		  x1: xAxis_x_start, y1: xAxis_y_start,
		  x2: xAxis_x_end, y2: xAxis_y_end,
		  x3: xAxis_x_end, y3: xAxis_y_end - 3,
		});		
		xAxis_x_start = xAxis_x_end;
	}	
	//draw xAxis arrow -- (xaxis length = codes.length * fontsize + 30)
	$('canvas.axis').drawLine({
	  layer: true,
	  strokeStyle: 'grey',
	  strokeWidth: 1.5,
	  rounded: true,
	  endArrow: true,
	  arrowRadius: 6,
	  arrowAngle: 90,
	  x1: xAxis_x_start, y1: xAxis_y_start,
	  x2: xAxis_x_start + 20, y2: xAxis_y_start,
	});
	
	//draw yAxis	
	var v = 0.5;	
	for(var i = 0; i < 2; i++) {
		var yAxis_x_end = yAxis_x_start;
		var yAxis_y_end = yAxis_y_start - gridwidth; //grid width:72
		$('canvas.axis').drawLine({
		  layer: true,
		  strokeStyle: 'grey',
		  strokeWidth: 1.5,
		  x1: yAxis_x_start, y1: yAxis_y_start,
		  x2: yAxis_x_end, y2: yAxis_y_end,
		  x3: yAxis_x_end - 3, y3: yAxis_y_end,
		});
		$('canvas.axis').drawText({
		  layer: true,
	      fillStyle: '#000',
		  strokeStyle: '#25a',
		  strokeWidth: 0,
		  x: yAxis_x_end - 10 - 10, y: yAxis_y_end,
		  fontSize: fontsize,
		  fontFamily: fontfamily,
		  text: v + "",		  
		});		
		yAxis_y_start = yAxis_y_end;
		v += 0.5;
	}
	
	//draw yAxis arrow -- (yaxis length = 2 * gridwidth + 30)
	$('canvas.axis').drawLine({
	  layer: true,
	  strokeStyle: 'grey',
	  strokeWidth: 1.5,
	  rounded: true,
	  endArrow: true,
	  arrowRadius: 6,
	  arrowAngle: 90,
	  x1: yAxis_x_start, y1: yAxis_y_start,
	  x2: yAxis_x_start, y2: yAxis_y_start - 20,
	});
	
	//draw xAxis name
	for(var i=0;i<codes.length;i++) {
		var color = '#000';
		// if(gps.indexOf(i) > -1 ){
		// 	color = 'red';
		// }
		$('canvas.axis').drawText({
		  layer: true,
	      fillStyle: color,
		  strokeStyle: '#000000',
		  strokeWidth: 0,
		  x: x_origin + 1.5*fontsize * i+17, y: y_origin,
		  fontSize: fontsize,
		  fontFamily: fontfamily,
		  text: codes[i]
		});	
	}
	
	//draw yAxis threshold line
	var threshold_x_start = center_x;
	var threshold_y_start = center_y - gridwidth * 2 * 0.5;
	var threshold_x_end = threshold_x_start + fontsize*1.5 * codes.length + 10;
	var threshold_y_end = threshold_y_start;
	$('canvas.axis').drawLine({
	  layer: true,
	  strokeStyle: '#ebc9ee',
	  strokeWidth: 2,
	  strokeDash: [5],
	  x1: threshold_x_start, y1: threshold_y_start,
	  x2: threshold_x_end, y2: threshold_y_end,	  
	});
	// $('canvas.axis').drawText({
	  // layer: true,
	  // fillStyle: 'grey',
	  // strokeStyle: '#25a',
	  // strokeWidth: 0,
	  // x: threshold_x_start - 13 - 10, y: threshold_y_start,
	  // fontSize: 12,
	  // fontFamily: fontfamily,
	  // text: "25%"
	// });
}
function drawAsa(var1, var2, var3, var4, var5, var6){
	var codes = var1;
	var values = var2;
	var linecolor = var3;
	var linecolorlight = var4;
	var title = var5;
	var index = var6;
	var positionValue = "";
	//parameters build-in
	var x_origin = 75;
	var y_origin = 280;
	//draw line	
	for(var i=0;i < codes.length - 1;i++) {
		var value_x_start = x_origin + fontsize*1.5 * i;
		var value_y_start = y_origin - 15 - gridwidth * 2 * values[i];
		var value_x_end = x_origin + fontsize*1.5 * (i + 1);
		var value_y_end = y_origin - 15 - gridwidth * 2 * values[i + 1];		
		var k = values[i + 1];
		var c = codes[i + 1];

		positionValue = positionValue+value_x_end+"_"+value_y_end+":"+k+":"+c+"@";

		$('canvas.axis').drawLine({
		  layer: true,		  
		  strokeStyle: linecolor,
		  strokeWidth: 2,
		  x1: value_x_start, y1: value_y_start,
		  x2: value_x_end, y2: value_y_end,		  
		});

		$('canvas.axis').drawRect({
		  layer: true,			  	 
		  fillStyle: 'white',
		  opacity: 0,
		  strokeStyle: linecolor,
		  strokeWidth: 0,
		  x: value_x_end, y: value_y_end,
		  width: fontsize,
		  height: 100,
		  mouseover: function(layer) {
			$('canvas.axis').drawEllipse({
				layer: true,
				groups: ['myPanel'],
				fillStyle: linecolor,				
				strokeStyle: linecolorlight,
				strokeWidth: 4,
				x: layer.x, y: layer.y,
				width: 16, height: 16
			});
			panel(layer.x,layer.y,"Value",positionValue, '#ca40ee');
		  },
		  mouseout: function() {			  
			$('canvas.axis').removeLayerGroup( 'myPanel' );
		  },		  
		});
		if(index == 0){
            if(i==0){
                $('canvas.axis').drawEllipse({
                    layer: true,
                    fillStyle: linecolor,
                    x: value_x_start, y: value_y_start,
                    width: 7, height: 7,
                });}
			$('canvas.axis').drawEllipse({
			  layer: true,
			  fillStyle: linecolor,
			  x: value_x_end, y: value_y_end,
			  width: 7, height: 7,
			  mouseover: function(layer) {
				$('canvas.axis').drawEllipse({
					layer: true,
					groups: ['myPanel'],
					fillStyle: linecolor,				
					strokeStyle: linecolorlight,
					strokeWidth: 4,
					x: layer.x, y: layer.y,
					width: 16, height: 16
				});
				panel(layer.x,layer.y,"Value",positionValue, '#ca40ee');
			  },
			  mouseout: function() {			  
				$('canvas.axis').removeLayerGroup( 'myPanel' );
			  },
			});
		}		
		if(index == 1){
			$('canvas.axis').drawPolygon({
			  layer: true,
			  fillStyle: linecolor,
			  x: value_x_end, y: value_y_end,
			  radius: 5,
			  sides: 3,
			  mouseover: function(layer) {
				$('canvas.mycanvas').drawEllipse({
					layer: true,
					groups: ['myPanel'],
					fillStyle: linecolor,				
					strokeStyle: linecolorlight,
					strokeWidth: 4,
					x: layer.x, y: layer.y,
					width: 16, height: 16
				});
				panel(layer.x,layer.y,"Value",positionValue, '#ca40ee');
			  },
			  mouseout: function() {			  
				$('canvas.axis').removeLayerGroup( 'myPanel' );
			  },
			});
		}		
	}	
	
	//draw lenged
	var text = var5;
	var lengend_line_x_end = lengend_x_p + 25;
	var lengend_line_y_end = lengend_y_p;
	$('canvas.axis').drawLine({
	  layer: true,
	  strokeStyle: linecolor,
	  strokeWidth: 1,
	  x1: lengend_x_p, y1: lengend_y_p + fontsize / 2,
	  x2: lengend_line_x_end, y2: lengend_line_y_end + fontsize / 2,
	  fromCenter: false
	});
	var lengend_text_x = lengend_line_x_end + 3;
	var lengend_text_y = lengend_y_p;
	$('canvas.axis').drawText({
	  layer: true,
	  fillStyle: '#000',
	  strokeStyle: '#25a',
	  strokeWidth: 0,
	  x: lengend_text_x, y: lengend_text_y,
	  fontSize: fontsize - 3,
	  fontFamily: fontfamily,
	  text: text,
	  fromCenter: false
	});	
	lengend_y_p = lengend_y_p + fontsize;	
}

function panel(var1,var2,var3,var4,var5){
	var start_x = var1;
	var start_y = var2;
	var type = var3;		
	var valueStr = var4;
	var panelcolor = var5;		
	//var color = var5;

	var regstr = start_x+"_"+start_y+":"+"(0\\.\\d+)"+":"+"(\\w)";

	var re =new RegExp(regstr);
	re.test(valueStr);
	var textValue = RegExp.$1;
	var textCode = RegExp.$2;
	//parameters
	var radius = 4;
	var panelWidth = 140;
	var panelHeight = 50;
	var distance_Polygon_rect = 13;		
	$('canvas.axis').drawPolygon({
	  layer: true,
	  groups: ['myPanel'],
	  fillStyle: panelcolor,
	  strokeStyle: panelcolor,
	  strokeWidth: 2,
	  x: start_x, y: start_y - distance_Polygon_rect,
	  radius: 4,
	  sides: 3,
	  rotate: 180
	});
	$('canvas.axis').drawRect({
	  layer: true,
	  groups: ['myPanel'],
	  fillStyle: 'white',
	  opacity: 0.8,
	  strokeStyle: panelcolor,
	  strokeWidth: 2,
	  x: start_x, y: start_y - distance_Polygon_rect - radius/2 - panelHeight/2,
	  width: panelWidth+15,
	  height: panelHeight,
	  cornerRadius: 8
	});
	$('canvas.axis').drawText({
	  layer: true,
	  groups: ['myPanel'],
	  fillStyle: '#000000',
	  strokeStyle: '#000000',
	  strokeWidth: 0,
	  x: start_x - panelWidth/2 + 2 + 10, y: start_y - distance_Polygon_rect - radius/2 - panelHeight + 7,
	  fontSize: fontsize ,
	  fontFamily: fontfamily,
	  text: textCode,
	  fromCenter: false,
	});
	$('canvas.axis').drawEllipse({
	  layer: true,
	  groups: ['myPanel'],
	  fillStyle: panelcolor,
	  x: start_x - panelWidth/2 + 2 + 10 + 5, y: start_y - distance_Polygon_rect - radius/2 - panelHeight + 10 + fontsize + 7,
	  width: 7, height: 7,	 
	});
	$('canvas.axis').drawText({
	  layer: true,
	  groups: ['myPanel'],
	  fillStyle: '#000000',
	  strokeStyle: '#000000',
	  strokeWidth: 0,
	  x: start_x - panelWidth/2 + 2 + 10 + 15, y: start_y - distance_Polygon_rect - radius/2 - panelHeight + 10 + fontsize,
	  fontSize: fontsize  ,
	  fontFamily: fontfamily,
	  text: type + ":  " +textValue,
	  fromCenter: false,
	});	
	$('canvas.axis').drawLayers('myPanel');
}
function panel1(var1,var2,var3,var4,var5,var6){
    var start_x = var1;
    var start_y = var2;
    var type1 = var3;
    var type2 = var4;
    var valueStr = var5;
    var panelcolor = var6;
    //var color = var5;
    //alert (valueStr);
    var regstr = type1+"_"+type2+":"+"(\\w+)"+":"+"(\\d+)"+":"+"(\\d+)";
    // var regstr1 = type1+"_"+type2+":"+"(\\s+)";
    //alert(valueStr+var3+var4);
    var re =new RegExp(regstr);
    re.test(valueStr);
    var textValue = RegExp.$2;
    var textCode = RegExp.$3;
    // var re1 =new RegExp(regstr1);
    // re1.test(tex0);
    var tex = RegExp.$1;
	tex=tex.replace(/n_l/g, "n-l").replace(/D_l/g, "D-l").replace(/d_c/g, "d-c").replace(/_/g, " ");

    // var textValue = valueStr;
    // var textCode = type;
    //parameters
    var radius = 4;
    var panelWidth = 215;
    var panelHeight = 70;
    var distance_Polygon_rect = 13;
    var xx=start_x - panelWidth/2;
    var xx1=0;
    if (xx<10){xx1=10-xx;}
    if (xx+ panelWidth>970){xx1=970-(xx+ panelWidth);}
    $('canvas.mycanvas').drawPolygon({
        layer: true,
        groups: ['myPanel1'],
        fillStyle: panelcolor,
        strokeStyle: panelcolor,
        strokeWidth: 2,
        x: start_x, y: start_y - distance_Polygon_rect,
        radius: 4,
        sides: 3,
        rotate: 180
    });
    $('canvas.mycanvas').drawRect({
        layer: true,
        groups: ['myPanel1'],
        fillStyle: 'white',
        opacity: 0.8,
        strokeStyle: panelcolor,
        strokeWidth: 2,
        x: start_x+xx1, y: start_y - distance_Polygon_rect - radius/2 - panelHeight/2,
        width: panelWidth+5,
        height: panelHeight,
        cornerRadius: 8
    });
    $('canvas.mycanvas').drawText({
        layer: true,
        groups: ['myPanel1'],
        fillStyle: '#000000',
        strokeStyle: '#000000',
        strokeWidth: 0,
        x: start_x +xx1- panelWidth/2 + 2 + 10, y: start_y - distance_Polygon_rect - radius/2 - panelHeight + 7,
        fontSize: fontsize-3 ,
        fontFamily: fontfamily,
        text: tex,
        fromCenter: false,
    });
    $('canvas.mycanvas').drawText({
        layer: true,
        groups: ['myPanel1'],
        fillStyle: '#000000',
        strokeStyle: '#000000',
        strokeWidth: 0,
        x: start_x +xx1- panelWidth/2 + 2 + 10, y: start_y - distance_Polygon_rect - radius/2 - panelHeight + 30,
        fontSize: fontsize-3 ,
        fontFamily: fontfamily,
        text: 'Start: '+textValue,
        fromCenter: false,
    });

    $('canvas.mycanvas').drawText({
        layer: true,
        groups: ['myPanel1'],
        fillStyle: '#000000',
        strokeStyle: '#000000',
        strokeWidth: 0,
        x: start_x +xx1- panelWidth/2 + 2 + 10, y: start_y - distance_Polygon_rect - radius/2 - panelHeight + 30 + fontsize,
        fontSize: fontsize-3  ,
        fontFamily: fontfamily,
        text: 'End: '+textCode,
        fromCenter: false,
    });
    $('canvas.mycanvas').drawLayers('myPanel1');
}
function drawTitle(){
	//draw Title
	var x_origin = 60;
	var y_origin = 280;
	var text_x = x_origin;
	var text_y = lengend_y_p - fontsize - 40;
    //$('canvas.axis').drawLine({
    //    layer: true,
    //    strokeStyle: '#ee91d5',
     //   strokeWidth: 2,
     //   x1: text_x - fontsize / 2-20, y1: y_origin - 260,
     //   x2: text_x - fontsize / 2+30, y2: y_origin - 260,
    //});
	//$('canvas.axis').drawText({
	//  layer: true,
	//  fillStyle: 'black',
	//  strokeStyle: '#25a',
	//  strokeWidth: 0,
	//  x: text_x - fontsize / 2+45, y: y_origin - 270,
	//  fontSize: fontsize + 1,
	//  fontFamily: fontfamily,
	//  text: "Disorder propensity",
	//  fromCenter: false,

	//});
}

// canvas
function drawSite(var1,var2,var3){
	var width = var1;
	var length = var2;
	var codes = var3;	
	//parameters build-in
	var height = 25;
	//draw text
	$('canvas.mycanvas').drawText({
	  layer: true,
	  fillStyle: 'black',
	  strokeStyle: '#25a',
	  strokeWidth: 0,
	  x: x_p, y: y_p + fontsize + 20,
	  fontSize: fontsize + 1,
	  fontFamily: fontfamily,
	  text: "Domain structure",
	  fromCenter: false,
	});
	//draw sequence
	var left_top_rect_x = x_p;
	var left_top_rect_y = y_p + fontsize + 5 + 5;
	var dom=new Array();
    for(var i=0;i<codes.length;i++) {
        var arr = codes[i].split("=")[0];
        if (dom.indexOf(arr)<0){
            left_top_rect_y=left_top_rect_y+57
			var tex=arr.split('&')[0];
	var gradient = $('canvas.mycanvas').createGradient({
	  // Gradient is drawn relative to layer position
	  x1: 0, y1: left_top_rect_y + height / 2 - 20,
	  x1: 0, y2: left_top_rect_y + height / 2 + 20,
        c1: 'grey', s1:0.2,
        c2: '#eeeeee', s2:0.5,
        c3: 'grey',s3:0.8
	  // c1: '#ee91d5', s1:0.2,
	  // c2: '#fee1f5', s2:0.5,
	  // c3: '#ee91d5',s3:0.8
	});
	$('canvas.mycanvas').drawText({
		layer: true,
		fillStyle: 'black',
		x: left_top_rect_x+width/2, y: left_top_rect_y -fontsize+7,
		fontSize: fontsize ,
		fontFamily: fontfamily,
		text: tex
	});
	$('canvas.mycanvas').drawRect({
	  layer: true,
	  fillStyle: gradient,
	  strokeStyle: 'black',
	  strokeWidth: 0.5,
	  x: left_top_rect_x, y: left_top_rect_y,
	  width: width,
	  height: height,
	  fromCenter: false,
      // cornerRadius: 8
	});
        dom.push(arr);
        }
    }
	//draw start end position
	$('canvas.mycanvas').drawLine({
	  layer: true,
	  strokeStyle: 'black',
	  strokeWidth: 1,
	  x1: left_top_rect_x+1, y1: left_top_rect_y+20,
	  x2: left_top_rect_x+1, y2: left_top_rect_y + height + 10,
	});
	$('canvas.mycanvas').drawText({
		layer: true,
		fillStyle: 'black',				
		x: left_top_rect_x, y: left_top_rect_y + height + 10 + fontsize / 2,
		fontSize: fontsize ,
		fontFamily: fontfamily,
		text: '1'
	});
	$('canvas.mycanvas').drawLine({
	  layer: true,
	  strokeStyle: 'black',
	  strokeWidth: 0.8,
	  x1: left_top_rect_x + width-1, y1: left_top_rect_y+20,
	  x2: left_top_rect_x + width-1, y2: left_top_rect_y + height + 10,
	});
	$('canvas.mycanvas').drawText({
		layer: true,
		fillStyle: 'black',				
		x: left_top_rect_x + width, y: left_top_rect_y + height + 10 + fontsize / 2,
		fontSize: fontsize ,
		fontFamily: fontfamily,
		text: length
	});
	//
	var xoffset = 10;
	var yoffset = 10;
	var max_yoffset = yoffset;
    // var se1=new Array();
    // var se2=new Array();
    var positionValue =''
    var tex0 =''
	for(var i=0;i<codes.length;i++) {	
		var arr = codes[i].split("=");


		var residue = arr[0];
		var site1 = parseInt(arr[1].split('+')[0]);
        var site2 = parseInt(arr[1].split('+')[1]);
		// var x_site = x_p + site / length * width;
		// var y_site = y_p + fontsize + 5 + 5 + height;
	    var color=residue.split('&')[1];
        var tex1=residue.split('&')[0].replace(/ /g, "_").replace(/-/g, "_");
        //var tex1=residue.split('&')[0].replace(/-/g, "_");
        var domy=left_top_rect_y+(dom.indexOf(residue)-dom.length+1)*57;
        var domy1=(x_p + site1 / length * width);
        // se1.push(site1);
        // se2.push(site2);
        //tex0 = tex0+(x_p + site1 / length * width)+"_"+domy+":"+tex1+"@";
        positionValue = positionValue+domy1+"_"+domy+":"+tex1+":"+site1+":"+site2+"@";
        //alert(positionValue);
        var gradient1 = $('canvas.mycanvas').createGradient({
            // Gradient is drawn relative to layer position
            x1: 0, y1: domy + height / 2 - 20,
            x1: 0, y2: domy + height / 2 + 20,
            c1: color, s1:0.2,
            c2: '#eeeeee', s2:0.5,
            c3: color,s3:0.8
            // c1: '#ee91d5', s1:0.2,
            // c2: '#fee1f5', s2:0.5,
            // c3: '#ee91d5',s3:0.8
        });
        $('canvas.mycanvas').drawRect({
            layer: true,
            fillStyle: gradient1,
            strokeStyle: 'black',
            strokeWidth: 0.5,
            x: domy1, y: domy,
            width: (site2-site1)/length * width,
            height: height,
            fromCenter: false,
            mouseover: function(layer) {
                //alert ((site2-site1)/length * width);
                $('canvas.mycanvas').drawRect({
                    layer: true,
                    groups: ['myPanel1'],
                    // fillStyle: FALSE,
                    strokeStyle: '#ca40ee',
                    strokeWidth: 3,
                    x: layer.x+layer.width/2, y: layer.y+layer.height/2,
                    width: layer.width, height: layer.height
                });

                panel1(layer.x+layer.width/2,layer.y,layer.x,layer.y,positionValue, '#ca40ee');
            },
            mouseout: function() {
                $('canvas.mycanvas').removeLayerGroup( 'myPanel1' );
            },
        });
		// if(i > 0){
		// 	var previous = codes[i-1].split("-");
		// 	var previous_site = parseInt(previous[1]);
		// 	var x_previous = previous_site / length * width;
		// 	//var distance = codes[i].length * fontsize / 2 + codes[i - 1].length * fontsize / 2;
		// 	//alert(distance);
		// 	if((x_site - x_previous) < 42){
		// 		xoffset = xoffset - 2;
		// 		yoffset = yoffset + fontsize / 2;
		// 	}else{
		// 		xoffset = 10;
		// 		yoffset = 10;
		// 	}
		// }
		// if(max_yoffset < yoffset){
		// 	max_yoffset = yoffset;
		// }
		// $('canvas.mycanvas').drawLine({
		//   layer: true,
		//   index: 0,
		//   strokeStyle: 'grey',
		//   strokeWidth: 1,
		//   x1: x_site, y1: y_site,
		//   x2: x_site - xoffset, y2: y_site + yoffset,
		//   x3: x_site - xoffset, y3: y_site + yoffset + yoffset,
		// });
		// $('canvas.mycanvas').drawText({
		// 	layer: true,
		// 	fillStyle: 'red',
		// 	x: x_site - xoffset, y: y_site + yoffset + yoffset + fontsize / 2,
		// 	fontSize: fontsize,
		// 	fontFamily: fontfamily,
		// 	text: residue + (site)
		// });
	}
	y_p = y_site + max_yoffset + 70 + fontsize;
}


function drawPieChart2 (var1, var2, var3,var4){
	//****************************************************************************************************//
	//**	var kinaseGroup = new Array("AGC","CAMK","CMGC","CK1","RGC","TK","TKL","Other");			**//
	//**	var siteNumber = new Array(30,40,50,20,60,80,10,40);										**//
	//**	drawPieChart2(kinaseGroup,siteNumber,"Distribution of S/T/Y",400);							**//
	//****************************************************************************************************//
	var names = var1;
	var numbers = var2;
	var legend = var3;
	var rightoffset = var4;
	
	//parameters build-in
	var radius = 100;
	var center_x = x_p + rightoffset;
	var center_y = y_p + 30 + radius;
	var colors = ['#A5E018','#A52DD4','#3F124A','#11E0B1','#F77617','#82B15C','#E110B5','#CBFA58','#1E7A43'];//the front 8 build-in colors
	//parseInt
	for(var i = 0;i < numbers.length;i++){
		numbers[i] = parseInt(numbers[i]);		
	}
	// draw pie chart
	var zero = 0;
	var index = 0;
	var total = 0;	
	for(var i = 0;i < numbers.length;i++){
		total = total + numbers[i];	
		if(numbers[i] != 0){
			zero++;
			index = i;
		}		
	}
	//alert(zero+":" + index);
	if(zero == 1){
		$('canvas.mycanvas').drawEllipse({
			layer: true,			
			fillStyle: colors[index],
			x: center_x, y: center_y,
			width: radius * 2, height: radius * 2
		});
		$('canvas.mycanvas').drawText({
			layer: true,
			fillStyle: '#fff',
			x: center_x, y: center_y,
			fontFamily: fontfamily,
			fontSize: fontsize,
			text: names[index] + ": " + '100' + "%"
		});
	}else{
		var start = -90;
		var end = -90;	
		for(var i = 0;i < numbers.length;i++){
			var angle = numbers[i] / total * 360;			
			if(i == 0){
				end  = start + angle;			
			}else if(i == numbers.length - 1){
				start = end;
				end = -90;			
			}else{
				start = end;
				end = start + angle;
			}
			var random_color = "";
			if(i < colors.length){
				random_color = colors[i];
			}else{
				random_color = "#" + randomColor();
				// while(colors.indexOf(random_color) == 0){
					// random_color = "#" + randomColor();
				// }
			}			
			if(angle == 0){
				end = start;
			}
			//alert(start+" | "+end);
			$('canvas.mycanvas').drawSlice({
				layer: true,
				index: 0,
				name: names[i],
				groups: ['chart', 'slices'],
				fillStyle: random_color,
				x: center_x, y: center_y,
				start: start, end: end,
				radius: radius,
				spread: 1 / 40
			})		
		}
		// draw pie chart percent text
		start = -90;
		end = -90;
		var x = center_x;
		var y = center_y;
		for(var i = 0;i < numbers.length;i++){
			var angle = numbers[i] / total * 360;
			if(angle != 0){
				if(i == 0){
					end  = start + angle;
					x = center_x - Math.cos((angle/2) * Math.PI * 2/360) * radius * 2/3;
					y = center_y - Math.sin((angle/2) * Math.PI * 2/360) * radius * 2/3;
				}else if(i == numbers.length - 1){
					start = end;
					end = -90;
					x = center_x + Math.cos((90- angle/2 - start) * Math.PI * 2/360) * radius * 2/3;
					y = center_y - Math.sin((90- angle/2 - start) * Math.PI * 2/360) * radius * 2/3;
				}else{
					start = end;
					end = start + angle;			
					x = center_x + Math.cos((90- angle/2 - start) * Math.PI * 2/360) * radius * 2/3;
					y = center_y - Math.sin((90- angle/2 - start) * Math.PI * 2/360) * radius * 2/3;
				}
				var percent = Math.round(angle/360 * 100);
				$('canvas.mycanvas').drawText({
					layer: true,			
					fillStyle: '#fff',
					x: x, y: y,
					fontFamily: fontfamily,
					fontSize: fontsize - 10,
					text: names[i] + ": " + percent + "%"
				})
			}		
		}
	}
	//draw legend
	var lengend_x_start = center_x;
	var lengend_y_start = center_y - radius - 20;
	$('canvas.mycanvas').drawText({
	  layer: true,		  		 
	  fillStyle: 'black',
	  x: lengend_x_start, y: lengend_y_start,
	  fontSize: fontsize + 5,
	  fontFamily: fontfamily,
	  text: legend,	  
	});
}

function randomColor( ) {  
	var rand = Math.floor(Math.random( ) * 0xFFFFFF).toString(16);  
	if(rand.length == 6){  
		return rand;  
	}else{  
		return randomColor();  
	}
}
function drawTjAxis(var1,var2,var3,var4){
	//********************************************************************************//
	//**	var structureName = new Array("Alpha-Helix","Coil","Beat-strand");		**//
	//**	var structureValue = [[8,9,7],[5,7,10],[3,5,4]];						**//
	//**	drawTjAxis(structureName,structureValue,"Distribution of S/T/Y",600);	**//
	//********************************************************************************//
	var names = var1;
	var values = var2;
	var legend = var3;
	var rightoffset = var4;
	
	//parameters build-in
	var deep = 220;	
	var x_length = 280;	//x-axis length width
	var y_length = 180;	//y-axis length width
	var barwidth = 18;	//bar width
	var y_scale = 2;	//y-axis scale number
	
	//origin coordinate
	var origin_x = x_p + rightoffset;	// refer the origin coordinate is ok
	var origin_y = y_p + deep;				// refer the origin coordinate is ok
		
	//x axis end 
	var xAxis_x_end = origin_x + x_length + 50;
	var xAxis_y_end = origin_y;	
	//y axis end 
	var yAxis_x_end = origin_x;
	var yAxis_y_end = origin_y - y_length - 20;	
	
	//draw xAxis
	$('canvas.mycanvas').drawLine({
	  layer: true,
	  strokeStyle: '#000',
	  strokeWidth: 1,
	  rounded: true,
	  endArrow: true,
	  arrowRadius: 6,
	  arrowAngle: 90,
	  x1: origin_x, y1: origin_y,
	  x2: xAxis_x_end, y2: xAxis_y_end,
	});
	//draw yAxis
	$('canvas.mycanvas').drawLine({
	  layer: true,
	  strokeStyle: '#000',
	  strokeWidth: 1,
	  rounded: true,
	  endArrow: true,
	  arrowRadius: 6,
	  arrowAngle: 90,
	  x1: origin_x, y1: origin_y,
	  x2: yAxis_x_end, y2: yAxis_y_end,
	});	
	//draw bar	
	var x_step = x_length / values.length;
	var color = new Array("#c33","#6c0","#36c");
	var max = 0;	
	for(var i =0; i < values.length;i++){
		var arr = values[i];
		for(var j =0; j < arr.length;j++){
			arr[j] = parseInt(arr[j]);
			if(arr[j] > max){				
				max = arr[j];
			}
		}
	}
	//alert(max);
	for(var i =0; i < values.length;i++){
		var arr = values[i];		
		var position_x = origin_x + x_step * (i + 1) - barwidth * arr.length / 2;		
		for(var j =0; j < arr.length;j++){
			var Coloum_x_start = position_x + j * barwidth;
			var Coloum_y_start = origin_y - (arr[j] / max) * y_length / 2;
			var height = (arr[j] / max) * y_length;			
			$('canvas.mycanvas').drawRect({
			  layer: true,
			  fillStyle: color[j],			  
			  x: Coloum_x_start, y: Coloum_y_start,
			  width: barwidth,
			  height: height,
			});
		}
		//draw x axis name
		$('canvas.mycanvas').drawText({
		  layer: true,		  		 
	      fillStyle: '#0088FF',
		  x: position_x + barwidth * arr.length / 2 - 10, y: origin_y + 12,//text downoffset
		  fontSize: fontsize,
		  fontFamily: fontfamily,
		  text: names[i],		  
		});	
	}
	//draw y-scale rule text	
	var y_step = y_length % y_scale;
	if(y_step == 0){
		y_step = y_length / y_scale
	}else{
		y_step = (y_length - y_step) / y_scale;
	}
	for(var i = 1;i <= y_scale;i++){
		var line_start_x = origin_x - 4;
		var line_start_y = origin_y - i * y_step;
		var line_end_x = xAxis_x_end;
		var line_end_y = line_start_y;
		$('canvas.mycanvas').drawLine({
		  layer: true,
		  strokeStyle: 'grey',
		  strokeWidth: 1,
		  strokeDash: [5],
		  x1: line_start_x, y1: line_start_y,
		  x2: line_end_x, y2: line_end_y,
		});	
		var ruletext = i * max / y_scale;
		var displaytext = "" + ruletext.toFixed(1);
		$('canvas.mycanvas').drawText({
		  layer: true,		  		 
	      fillStyle: 'grey',
		  x: line_start_x - 12 - displaytext.length, y: line_start_y,
		  fontSize: 12,
		  fontFamily: fontfamily,
		  text: displaytext,
		});
	}
	//draw y-lengend text
	var lengend_x_start = origin_x - 12 - 30;
	var lengend_y_start = origin_y - y_length / 2;	
	$('canvas.mycanvas').drawText({
	  layer: true,		  		 
	  fillStyle: 'black',
	  x: lengend_x_start, y: lengend_y_start,
	  fontSize: 12,
	  fontFamily: fontfamily,
	  text: legend,
	  rotate: -90
	});
}

function getwidth(codes){
	var width = 130 + codes.length * fontsize*1.5;
	return width;
}